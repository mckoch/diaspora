----------
  
[configMarkdown](configMarkdown.html) | [devnotes](devnotes.html) | [DiasporaCredits](DiasporaCredits.html) | [dsp_params](dsp_params.html)	| [dsp_readme](dsp_readme.html) 

-----------


## About Diaspora dsp: LUA file plugin ##

Diaspora inspects the SimCity4 game for tons of simulator values and periodically logs them to disc. More than this, it allows to alter quite a bunch of game parameters during a running city, without installing additional plugins than the dsp.dat itself (which is less than 3kb). The configuration of the plug may be altered at any time, so the player may immediately see and log to file what is happening. If i.e. a city won't develop CS$$, monitor according values (you decide which), temporary tweak some tuning constant to unlock a certain reward, adjust the caps or add some money (you may pay back later). It helps taking extensive 'diagnostic snapshots' of crashing cities (a nice file to add to the screen shots of CTD@load-cities). 

----------

Diaspora - shorthand dsp - is a small plug which periodically logs accessable in-game values of a running city to file. Configuration and log file may be changed at any time during a running city. For this, dsp provides three options: 

1. user configurable file logging functions,
2. a watchdog (but no food, sorry),
3. mapping functions to access sc4 in game data.

dsp consists of a small plugin (about 2k small), an external configuration file (which may be altered during a running city), plus the main lo gfile for collected data. If up, dsp will periodically log according to the state defined in the current patch (=configuration file). It's basic output will look similar to this:

    --# Apps/Diaspora/data.dat
    #0xfffff0#17#' readable lines in Apps\Diaspora\patch.dat
    #0x000001#1364841891#CONFIG
    #0x1305#0#-- passenger rail
    #0x1306#1#-- freight rail 
    #0x150A#0#-- landmark
    #0x150F#1#-- schools_k6
    #0x13110#8#-- CS1 (CS$)
    #0x13120#0#-- CS2 (CS$$)
    #0x13130#0#-- CS3 (CS$$$)
    #0x1307#0#-- Monorail station
    #0x000002#235954#current budget
    #0xffffff#
    --#

This is _output_ from the default configuration which counts Maxis' automata buildings. If only CS is tracked, each log entry will look similar to:

    --# Apps/Diaspora/data.dat
    #0xfffff0#17#' readable lines in Apps\Diaspora\patch.dat
    #0x000001#1364841891#CONFIG
    #0x13110#8#-- CS1 (CS$)
    #0x13120#0#-- CS2 (CS$$)
    #0x13130#0#-- CS3 (CS$$$)
    #0xffffff#
    --# 
which shows there are 8 small Commercial Services, but no CS$$$ or CS$. 
The config file would be similar to this:

    --# Apps/Diaspora/patch.dat
    #0xff0000#Apps\Diaspora\data.dat#logfile in sc4/Apps/  - required, tweakable.
    #0xfffff0#3#Watchdog's interval in minutes  - required, tweakable.
    #0xd0000a#0x13110#-- CS1 (CS$)
    #0xd0000a#0x13120#-- CS2 (CS$$)
    #0xd0000a#0x13130#-- CS3 (CS$$$)
    	dsp ignores lines which don't start with a valid token. 
    	That's quite handy for comments in patch.dat. So guess what the next line does:
    #0x020000#100#add to budget - sc4game.budget.deposit_funds(100)
    --#
    
This data may easily be used or generated by other applications. If you use the "turbo version" (which simply logs once per second), something like a tail -f looks very impressive. About a thousand different tokens to track and/or tweak almost any aspect of the game are included.  

## How to install and configure: ##

### Step One ###

1. Put dsp_pack.dat into your plugins directory, where all the plugs live.

2. In your /...somepath_to_ Maxis/SimCity/Apps folder create a subdirectory called 'Diaspora' (case sensitive). You may change the path for the log files once dsp is running.)

3. Copy the files config.dat and patch.dat to Apps/Diaspora/.

### Step Two ###

1. Start sc and load some city. 

2. Have a look at Apps/Diaspora/data.dat. It is a plain text file which may be read by any editor.

2. An interval of two minutes is preconfigured, so the log file  should start to grow.

### Step Three ###

Open Apps/Diaspora/patch.dat with a text editor. It looks similar to this:

    --#
    #0x000000#1364730031#Apps\Diaspora\patch.dat 
    #0xff0000#Apps\Diaspora\data.dat#logfile in sc4/Apps/ 
    #0xfffff1#silent#Watchdog mode: silent or annoying (niy)
    #0xfffff0#3#Watchdog's interval in minutes (niy)
    #0x000002#reserved#Total Budget. 
    #0xd0000a#0x1305#-- passenger rail
    #0xd0000a#0x1306#-- freight rail 
    #0xd0000a#0x150A#-- landmark
    #0xd0000a#0x150F#-- schools_k6
    #0xd0000a#0x13110#-- CS1 (CS$)
    #0xd0000a#0x13120#-- CS2 (CS$$)
    #0xd0000a#0x13130#-- CS3 (CS$$$)
    #0xd0000a#0x1307#-- Monorail station
    #0xffffff#Reserved for comment lines in this file. 
    --# 

Some general rules apply to the configuration file patch.dat:

1. Each line is read by dsp, only certain codes in the first row are evaluated.  

2. Comments may be placed on seperate lines and contain even HTML and JS, but they should not contain valid dsp Hex codes like #0xd0000a#.

3. Valid lines contain a token of the following pattern:


    	# 0x_dsp_hex_6digit # 0x_SC_hex # comment or legend, new line is new line	

i.e.

    	#0xd0000a#0x150A#-- landmark
    
    	which means '0xd0000a': get the value from SC's address '0x150A' and use '-- landmark' as label in the current log configuration. 
	
In this doc, a valid line is referenced as a 'token', which consists of three 'fields': a 'command' (or 'trigger'), a 'value' (or 'game address') and a user comment. Some triggers are read only, they are GETers, some are SETers too; some of the setters will need an additional parameter. 


----------

#### Some essential dsp triggers: ####

	'#0xd0000a' (dsp) denotes all objects accessible via sc4game.automata.get_source_building_count() function.
	'#0xff0000' (dsp) sets the path to current logfile under SC4\Apps\. REQUIRED.
	'#0x000002' (dsp) prints current budget.
	'#0xfffff0' (dsp) log interval in minutes. REQUIRED.

More useful details, examples and comments in patch.dat and the ReadMe. The configuration can be changed anytime in game, i.e. to track varying aspects of a loaded city into different log files which Diaspora will gracefully create.

*For more information and set of > 800 tokens see the distribution file.*

#### Limitations: ####
<strike>Since this is some kind of proof-of-concept release, dsp is restricted to data of type '#0xd0000a' (Maxis automata). </strike>. Diaspora can never ever 'load another plugin' nor does dsp alter the game or patches any other mod (hope so...). dsp is not suitable to inspect your plugin folder for installed plugins, but it is very suitable to find out if some are missing. It will not inspect saved games or pollute environment. Diaspora is not a cheat, even if it's fun to use dsp for just-a-little-bit-cheating.

#### Roadmap ####
N.N., but plenty of ideas. First of all: implement missing convenience functions. 
An eye on the 'do' mapper. 
Create advisors from patch.dat. Switch textures (would be great!!)?? 

#### Dependencies ####
None but SimCity4.

#### Compatibility ####
SimCity4, RushHour,CAMpatible. Works with almost any other plugin, if it messes up some address space post here, see the support page or pm the author.

## Package Content ##
- dsp_pack.dat 	: main Diaspora file in %yourfiles%/Plugins.
- dsp_pack_t.dat : 'turbo' which logs initial token set as fast as possible. Use to benchmark your machine ;) 
- patch.dat 	: the configuration file - edit this to change config tokens.
- data.dat 		: initial log file
- documentation.txt	: consult before editing patch.dat. Approx. 1000 tokens to cover most aspects of the game.
- readme.txt 	: this file.
- license.txt
- viewer.zip 	: contains a simple JavaScript data viewer + instructions.

### Current Version ###
dsp 0.2ÃŸ @ config 04/2013 

### Known Bugs ###
For some reason, dsp does not write log data immediately after creating a new log file. Diaspora does not check for errors in your configuration - but config may freeze the game/CTD it. If dsp encounters an error, it will silently terminate the current operation and have a new try after the defined interval, so in most cases: no fresh output in config file -> check the config first. To restart dsp, reload the current city.

### License ###
This software is BSD licensed. This means you may use and alter this code for your needs (which includes distributing, patching and forking in the community as long as the copy is licensed in the same way, not necessarily CC, any open license like GPL, MIT, Apache will do. Fixes, additions and extensions highly appreciated. Use by EA and their affiliates is strictly prohibited until they let the community freely run and patch SC5.

### Disclaimer ###
Diaspora will never be held responsible for the size, quantity or quality of your log files, games running at 5 frames/min, the sense or quality of it's code, it's coder, it's user, the weather or birds flying by. You agree it's author will never be made responsible for massive loss of time or any nervous disease while playing. The author is not associated with EA, and for sure will never be: open source for open minds. So this program is "is as is"-ware, no guaranties, no warranties, no promises, no claims, no lame, no shame. Best of all: it's absolutely free. No animals were harmed during development, but a c16761c Llamas went to nil.

2013/04/02 mck

PS: To mention this, I wrote this software because I'm seriously pissed off by sc5 - ehm, not the game, but it's distributors. Thanks to the developers at Maxis for about 25 years letting me play the most wonderful game which took up  lots of space on every of my hard drives since. Thanks to all modders, lotters, batters who made a tremendous effort to provide tons of unique buildings, patches, all this lovely data in the plugin folder which is the community essence of the game. And really makes it worth a 20th birthday. Love and blessings, M.

----------
  
[configMarkdown](configMarkdown.html) | [devnotes](devnotes.html) | [DiasporaCredits](DiasporaCredits.html) | [dsp_params](dsp_params.html)	| [dsp_readme](dsp_readme.html) 

-----------

*Document Version 1.00 
generated 6.04.2013 12:03:34* 
